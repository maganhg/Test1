{% extends "base.html" %}

{% block title %}ITIVA'S PAINKILLER{% endblock %}

{% block content %}
<!-- Carousel -->
<div id="carouselExampleSlidesOnly" class="carousel slide pointer-event" data-bs-ride="carousel" style="max-height: 300px; margin-bottom: 0;">
    <div class="carousel-inner">
        <div class="carousel-item">
            <img src="{{ url_for('static', filename='hlag02.webp') }}" class="d-block w-100" alt="Image 2">
        </div>
    </div>
</div>
<div class="container mt-4">
    <div class="row">
        <!-- Column 1 (Inverted) -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-header">
                    Requerimientos para la carga de archivos
                </div>
                <div class="card-body">
                    <div data-bs-spy="scroll" data-bs-target="#list-example" data-bs-offset="0" class="scrollspy-example" tabindex="0">
                        <h4 id="list-item-1"><strong>Requerimientos Generales:</strong></h4>
                        <ul>
                            <li>Solo se permite la carga de archivos XML y PDF</li>
                            <li>Cada archivo XML debe ir acompañado por su correspondiente PDF <u>bajo el mismo nombre</u>.</li>
                            <li>El nombre de los archivos no debe exceder de 30 caracteres de longitud.</li>
                            <li>Solo se aceptará cargar 50 archivos por evento equivalente a 25 facturas.</li>
                            <li>Carga de formatos diferentes no se entregaran correctamente.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Column 2 (Inverted) -->
        <div class="col-md-6 mb-4">
            <div class="card h-100">
                <div class="card-body">
                    <h2 class="mb-3">Hapag-Lloyd México</h2>
                    <h2 class="mb-4">Carga de documentos</h2>
                    <p>
                        {% with messages = get_flashed_messages() %}
                            {% if messages %}
                                <ul class="flashes">
                                {% for message in messages %}
                                    <li>{{ message }}</li>
                                {% endfor %}
                                </ul>
                            {% endif %}
                        {% endwith %}
                    </p>
                    <form method="post" action="/" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label for="files" class="form-label">Seleccione archivos</label>
                            <input type="file" class="form-control" id="files" name="files[]" multiple="true" autocomplete="off" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Enviar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Add Bootstrap Spinner -->
<div class="d-none" id="loading-spinner">
    <div class="spinner-border text-primary" role="status">
        <span class="sr-only">Loading...</span>
    </div>
    <p class="mt-2">Uploading...</p>
</div>

<!-- Add Bootstrap Alert -->
<div id="upload-alert" class="alert alert-dismissible fade show d-none" role="alert">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
    <div id="alert-message"></div>
</div>
<!-- JavaScript to toggle the spinner and display alert -->
<script>
    $(document).ready(function() {
        $("#upload-form").submit(function(e) {
            e.preventDefault(); // Prevent the default form submission
            $("#loading-spinner").removeClass("d-none"); // Show the spinner

            // Use FormData to submit the form data
            var formData = new FormData($(this)[0]);

            $.ajax({
                type: "POST",
                url: "/",
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    $("#loading-spinner").addClass("d-none"); // Hide the spinner
                    $("#upload-alert").removeClass("alert-danger").addClass("alert-success");
                    $("#alert-message").text(response.message);
                    $("#upload-alert").removeClass("d-none").alert();
                },
                error: function(response) {
                    $("#loading-spinner").addClass("d-none"); // Hide the spinner
                    $("#upload-alert").removeClass("alert-success").addClass("alert-danger");
                    $("#alert-message").text(response.responseJSON.message);
                    $("#upload-alert").removeClass("d-none").alert();
                }
            });
        });
    });
</script>

{% endblock %}
